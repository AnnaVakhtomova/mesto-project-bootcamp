(()=>{"use strict";var e={baseUrl:"https://nomoreparties.co/v1/wbf-cohort-2",headers:{authorization:"eb99d5b8-4ad4-4eef-a501-82ecc082db67","Content-Type":"application/json"}};function t(e){document.addEventListener("keydown",n),e.classList.add("popup_opened")}function o(e){document.removeEventListener("keydown",n),e.classList.remove("popup_opened")}function n(e){"Escape"===e.key&&o(document.querySelector(".popup_opened"))}var r=document.querySelector(".photo__cards"),c=document.querySelector("#card").content,a=document.querySelector("#image_popup"),u=a.querySelector(".popup__image "),i=a.querySelector(".popup__image-title");function s(o,n,r,s,l){var p=c.querySelector(".photo__card").cloneNode(!0),d=p.querySelector(".photo__image");d.src=r,d.alt=n;var f=p.querySelector(".photo__like-count");f.textContent=s,p.querySelector(".photo__title").textContent=n,p.querySelector(".photo__like").addEventListener("click",(function(t){var n;t.target.classList.contains("photo__like_active")?(n=o,fetch("".concat(e.baseUrl,"/cards/likes/").concat(n),{method:"DELETE",headers:e.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)}))).then((function(e){t.target.classList.remove("photo__like_active"),f.textContent=e.likes.length})):function(t){return fetch("".concat(e.baseUrl,"/cards/likes/").concat(t),{method:"PUT",headers:e.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)}))}(o).then((function(e){t.target.classList.add("photo__like_active"),f.textContent=e.likes.length}))}));var _=p.querySelector(".photo__delete");return l?_.addEventListener("click",(function(t){(function(t){return fetch("".concat(e.baseUrl,"/cards/").concat(t),{method:"DELETE",headers:e.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)}))})(o).then((function(){t.target.closest(".photo__card").remove()}))})):_.remove(),d.addEventListener("click",(function(e){u.src=r,u.alt=n,i.textContent=n,t(a)})),p}var l,p,d,f,_,m,h,v=function(e,t,o){b(e)?y(t,o):S(t,o)},y=function(e,t){e.classList.add(t),e.setAttribute("disabled",!0)},S=function(e,t){e.classList.remove(t),e.removeAttribute("disabled")},b=function(e){return e.some((function(e){return!e.validity.valid}))},q=document.querySelector(".profile__name"),g=document.querySelector(".profile__discoverer"),k=document.querySelector(".profile__avatar"),E=document.getElementById("profile_edit"),L=E.querySelector(".popup__form"),C=E.querySelector(".popup__form-input_name"),j=E.querySelector(".popup__form-input_about"),x=L.querySelector(".popup__form-button"),P=document.getElementById("image_add"),U=P.querySelector(".popup__form"),A=P.querySelector(".popup__form-input_name"),T=P.querySelector(".popup__form-input_about"),B=U.querySelector(".popup__form-button"),w=document.querySelector(".profile__button"),D=document.querySelector(".profile__add-button"),N=document.querySelector(".profile__avatar-container"),O=document.getElementById("change_avatar_popup"),I=O.querySelector(".popup__form"),J=O.querySelector(".popup__form-input_about"),H=O.querySelector(".popup__form-button");function z(e,t,o){q.textContent=e,g.textContent=t,k.src=o}fetch("".concat(e.baseUrl,"/users/me"),{headers:e.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)})).then((function(e){return z(e.name,e.about,e.avatar),e._id})).then((function(t){fetch("".concat(e.baseUrl,"/cards"),{headers:e.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)})).then((function(e){return function(e,t){e.forEach((function(e){var o=s(e._id,e.name,e.link,e.likes.length,e.owner._id===t);r.append(o)}))}(e,t)}))})),w.addEventListener("click",(function(){C.value=q.textContent,j.value=g.textContent,t(E)})),D.addEventListener("click",(function(){U.reset(),y(B,"popup__form-button_inactive"),t(P)})),N.addEventListener("click",(function(){I.reset(),y(H,"popup__form-button_inactive"),t(O)})),L.addEventListener("submit",(function(t){var n,r;t.preventDefault(),x.textContent="Сохранение...",(n=C.value,r=j.value,fetch("".concat(e.baseUrl,"/users/me"),{method:"PATCH",headers:e.headers,body:JSON.stringify({name:n,about:r})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)}))).then((function(e){return z(e.name,e.about,e.avatar)})).finally((function(e){o(E),x.textContent="Сохранить"}))})),U.addEventListener("submit",(function(t){var n,c;t.preventDefault(),B.textContent="Сохранение...",(n=A.value,c=T.value,fetch("".concat(e.baseUrl,"/cards"),{method:"POST",headers:e.headers,body:JSON.stringify({name:n,link:c})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)}))).then((function(e){return function(e,t,o,n){var c=s(e,t,o,void 0,!0);r.prepend(c)}(e.owner._id,e.name,e.link)})).finally((function(e){o(P),B.textContent="Сохранить"}))})),I.addEventListener("submit",(function(t){var n;t.preventDefault(),H.textContent="Сохранение...",(n=J.value,fetch("".concat(e.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:e.headers,body:JSON.stringify({avatar:n})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)}))).then((function(e){k.src=e.avatar})).finally((function(e){o(O),H.textContent="Сохранить"}))})),document.querySelectorAll(".popup").forEach((function(e){e.addEventListener("mousedown",(function(t){(t.target===t.currentTarget||t.target.classList.contains("popup__close"))&&o(e)}))})),p=(l={formSelector:".popup__form",inputSelector:".popup__form-input",submitButtonSelector:".popup__form-button",inactiveButtonClass:"popup__form-button_inactive",inputErrorClass:"form__input_type_error",errorClass:"form__input-error_active"}).formSelector,d=l.inputSelector,f=l.submitButtonSelector,_=l.inactiveButtonClass,m=l.inputErrorClass,h=l.errorClass,Array.from(document.querySelectorAll(p)).forEach((function(e){!function(e,t,o,n,r,c){var a=Array.from(e.querySelectorAll(t)),u=e.querySelector(o);v(a,u,n),a.forEach((function(t){t.addEventListener("input",(function(){!function(e,t,o,n){t.validity.valid?(t.classList.remove("popup__form-input_error"),function(e,t,o,n){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(o),r.classList.remove(n),r.textContent=""}(e,t,o,n)):(t.classList.add("popup__form-input_error"),function(e,t,o,n,r){var c=e.querySelector(".".concat(t.id,"-error"));t.classList.add(n),c.textContent=o,c.classList.add(r)}(e,t,t.validationMessage,o,n))}(e,t,r,c),v(a,u,n)}))}))}(e,d,f,_,m,h)}))})();